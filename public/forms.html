<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="css/commom.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/Sobre.css">
    link
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <title>Document</title>
</head>
<body>
    <header>
      <div id="header10"> 
        <ul>
            <li><a href="index.html"><i class="fa fa-home"></i>Home</a></li>
            <li><a href="produtos.html"><i class="fa-solid fa-spray-can-sparkles"></i></i>Produtos</a></li>
            <li><a href="sobre.html"><i class="fa-solid fa-address-card"></i>Sobre</a></li>
            <li><a href="forms.html"><i class="fa-brands fa-wpforms"></i></i>Forms</a></li>
        </ul>
        </div>
  
        <button class="position-fixed top-0 end-0 mt-0 pt-0" type="button" data-bs-toggle="offcanvas"
                data-bs-target="#offcanvasExample" aria-controls="offcanvasExample" style="border: none; background: none;">
            <img src="imagens/hamburuger.png" alt="Menu" style="width: 45px; height: 50px;">
        </button>
  
        <div class="offcanvas offcanvas-end custom-offcanvas" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="offcanvasExampleLabel"><h1 style="color: purple;">FILLIP'S PHARMA</h1></h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div id="penis">
              <div class="offcanvas-body">
                <ul class="offcanvas-list">
                    <li><a href="index.html"><i class="fa fa-home "></i>Home</a></li>
                    <li><a href="produtos.html"><i class="fa-solid fa-spray-can-sparkles"></i>Produtos</a></li>
                    <li><a href="sobre.html"><i class="fa-solid fa-address-card"></i>Sobre</a></li>
                    <li><a href="forms.html"><i class="fa-brands fa-wpforms"></i>Forms</a></li>
                </ul>
            </div>
          </div>
        </div>
 
    </header>
    <main class="container">
  <h1 class="text-center mb-5">Criar Produto</h1>
  <div id="produtos">
    <form class="row g-3" id="meuForm">

      <div class="col-md-12">
        <label for="nome" class="form-label">Nome</label>
        <input type="text" class="form-control" style="background: rgb(215, 50, 171); color: white; border-color: black; border-width: 4px;" id="nome" name="nome">
        <small id="nomeError" class="form-text text-danger" style="display: none;">Nome errado</small>
      </div>

      <div class="mb-3">
        <label for="descricao" class="form-label">Descrição</label>
        <textarea class="form-control"style="background: rgb(215, 50, 171); color: white; border-color: black; border-width: 4px;" name="descricao" id="descricao" rows="3"></textarea>
      </div>

      <div class="col-md-4">
        <label for="serie" class="form-label">Série</label>
        <input type="text" class="form-control" style="background: rgb(215, 50, 171); color: white; border-color: black; border-width: 4px;" name="serie" id="serie" aria-describedby="helpId" placeholder="">
        <small id="helpId" class="form-text text-muted">Número de Série (Único)</small>
      </div>

      <div class="col-md-4 offset-md-2">
        <label for="preco" class="form-label">Preço</label>
        <input type="text" class="form-control" style="background: rgb(215, 50, 171); color: white; border-color: black; border-width: 4px;" name="preco" id="preco" aria-describedby="helpId" placeholder="">
      </div>

      <div class="col-12">
        <button id="submitButton" type="submit" class="btn btn-primary" style="background: rgb(99,24,168);
        background: linear-gradient(90deg, rgba(99,24,168,1) 0%, rgba(221,39,207,0.9752275910364145) 100%); border-color: black; border-width: 2px;">Cadastrar Produto</button>
      </div>
    </form>

    <div id="preencherFotoDiv">
      <form id="preencherFotoForm">
        <div class="mb-3">
          <label for="avatar" class="form-label">Default file input example</label>
          <input class="form-control" type="file" id="avatar" name="avatar">
        </div>
        <div class="col-12">
          <button id="submitPhoto" type="submit" class="btn btn-primary">Alterar Foto</button>
        </div>
      </form>
    </div>
  </div>

  <div class="fundo1"></div>
</main>


  
 
  <script>

    const meuForm = document.getElementById("meuForm");
    const preencherFotoForm = document.getElementById("preencherFotoForm");
    const nomeError = document.getElementById('nomeError');

    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');

    meuForm.addEventListener('submit', ev => {
      ev.preventDefault();
      const formData = new FormData(meuForm);
      const produto = {};


      formData.forEach((valor, atributo) => produto[atributo] = valor);

      if(produto.nome.length < 5) {
        console.log('here error')
        nomeError.style = { display: 'block', color: 'red'}
        return;
      }

      console.log(JSON.stringify(produto))
      if(!id){
      fetch('http://localhost:38000/app/produtos', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(produto)
      })
        .then(r => r.json())
    } else {
      fetch('http://localhost:38000/app/produtos/'+id, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(produto)
      })
        .then(r => r.json())
    }
    })

    preencherFotoForm.addEventListener('submit', ev2 => {
      ev2.preventDefault();
      
     
      const formData2 = new FormData(preencherFotoForm);
      fetch('http://localhost:38000/app/produtos/' + id + '/photo', {
        method: 'PUT',
        body: formData2
      })
        .then(r => r.json())
    })

    function loadProduto() {
     
      if (id) {
        

        fetch('http://localhost:38000/app/produtos/' + id)
          .then(r => r.json())
          .then(produto => {
            console.log(produto)
            document.getElementById("nome").value = produto.nome
            document.getElementById("descricao").value = produto.descricao
            document.getElementById("preco").value = produto.preco
            document.getElementById("serie").value = produto.serie

          })

      } else {
        document.getElementById('preencherFotoDiv').style.display="none"
      }
    }


    loadProduto();

  </script>
       



    </main>
</body>
</html>